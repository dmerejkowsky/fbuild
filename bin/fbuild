#!/usr/bin/env python3.0

import os
import sys
from optparse import OptionParser, make_option

import fbuild.system
import fbuildroot

# -----------------------------------------------------------------------------

def parse_args(argv):
    parser = OptionParser()
    parser.add_options(fbuild.system.System.cmdline_options)

    try:
        extra_options = fbuildroot.cmdline_options
    except AttributeError:
        pass
    else:
        option_group = parser.add_option_group('project options')
        option_group.add_options(extra_options)

    return parser.parse_args(argv)


def main(argv=None):
    if argv is None:
        argv = sys.argv

    options, args = parse_args(argv)

    system = fbuild.system.System('config.yaml',
        verbose=options.verbose,
        threadcount=options.threadcount,
        nocolor=options.nocolor,
    )
    try:
        system.run(fbuildroot, options)
    except fbuild.ConfigFailed:
        return 1

    return 0

# -----------------------------------------------------------------------------

if __name__ == '__main__':
    sys.exit(main())
